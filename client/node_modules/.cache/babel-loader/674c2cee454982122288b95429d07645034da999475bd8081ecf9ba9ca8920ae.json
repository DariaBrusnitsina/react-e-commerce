{"ast":null,"code":"import axios from \"axios\";\nimport { toast } from \"react-toastify\";\nimport configFile from \"../config.json\";\nimport localStorageService from \"./localStorage.service\";\nimport authService from \"./auth.service\";\nconst http = axios.create({\n  baseURL: configFile.apiEndpoint\n});\nhttp.interceptors.request.use(async function (config) {\n  const expiresDate = localStorageService.getTokenExpiresDate();\n  const refreshToken = localStorageService.getRefreshToken();\n  if (configFile.isFireBase) {\n    const containSlash = /\\/$/gi.test(config.url);\n    config.url = (containSlash ? config.url.slice(0, -1) : config.url) + \".json\";\n    if (refreshToken && expiresDate < Date.now()) {\n      const data = await authService.refresh();\n      localStorageService.setTokens({\n        refreshToken: data.refresh_token,\n        idToken: data.id_token,\n        expiresIn: data.expires_id,\n        localId: data.user_id\n      });\n    }\n    const accessToken = localStorageService.getAccessToken();\n    if (accessToken) {\n      config.params = {\n        ...config.params,\n        auth: accessToken\n      };\n    }\n  } else {\n    if (refreshToken && expiresDate < Date.now()) {\n      const data = await authService.refresh();\n      localStorageService.setTokens({\n        refreshToken: data.refresh_token,\n        idToken: data.id_token,\n        expiresIn: data.expires_id,\n        localId: data.user_id\n      });\n    }\n    const accessToken = localStorageService.getAccessToken();\n    if (accessToken) {\n      config.params = {\n        ...config.params,\n        auth: accessToken\n      };\n    }\n  }\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n});\nfunction transformData(data) {\n  return data && !data._id ? Object.keys(data).map(key => ({\n    ...data[key]\n  })) : data;\n}\nhttp.interceptors.response.use(res => {\n  if (configFile.isFireBase) {\n    res.data = {\n      content: transformData(res.data)\n    };\n  }\n  return res;\n}, function (error) {\n  const expectedErrors = error.response && error.response.status >= 400 && error.response.status < 500;\n  if (!expectedErrors) {\n    console.log(error);\n    toast.error(\"Something was wrong. Try it later\");\n  }\n  return Promise.reject(error);\n});\nconst httpService = {\n  get: http.get,\n  post: http.post,\n  put: http.put,\n  delete: http.delete,\n  patch: http.patch\n};\nexport default httpService;","map":{"version":3,"names":["axios","toast","configFile","localStorageService","authService","http","create","baseURL","apiEndpoint","interceptors","request","use","config","expiresDate","getTokenExpiresDate","refreshToken","getRefreshToken","isFireBase","containSlash","test","url","slice","Date","now","data","refresh","setTokens","refresh_token","idToken","id_token","expiresIn","expires_id","localId","user_id","accessToken","getAccessToken","params","auth","error","Promise","reject","transformData","_id","Object","keys","map","key","response","res","content","expectedErrors","status","console","log","httpService","get","post","put","delete","patch"],"sources":["/Users/dariabrusnitsina/Yandex.Disk.localized/Programming/Projects/react-e-commerce/client/src/services/http.service.js"],"sourcesContent":["import axios from \"axios\";\nimport { toast } from \"react-toastify\";\nimport configFile from \"../config.json\";\nimport localStorageService from \"./localStorage.service\";\nimport authService from \"./auth.service\";\n\nconst http = axios.create({\n    baseURL: configFile.apiEndpoint\n});\n\nhttp.interceptors.request.use(\n    async function (config) {\n        const expiresDate = localStorageService.getTokenExpiresDate();\n        const refreshToken = localStorageService.getRefreshToken();\n\n        if (configFile.isFireBase) {\n            const containSlash = /\\/$/gi.test(config.url);\n            config.url =\n                (containSlash ? config.url.slice(0, -1) : config.url) + \".json\";\n            if (refreshToken && expiresDate < Date.now()) {\n                const data = await authService.refresh();\n\n                localStorageService.setTokens({\n                    refreshToken: data.refresh_token,\n                    idToken: data.id_token,\n                    expiresIn: data.expires_id,\n                    localId: data.user_id\n                });\n            }\n            const accessToken = localStorageService.getAccessToken();\n            if (accessToken) {\n                config.params = { ...config.params, auth: accessToken };\n            }\n        } else {\n            if (refreshToken && expiresDate < Date.now()) {\n                const data = await authService.refresh();\n\n                localStorageService.setTokens({\n                    refreshToken: data.refresh_token,\n                    idToken: data.id_token,\n                    expiresIn: data.expires_id,\n                    localId: data.user_id\n                });\n            }\n            const accessToken = localStorageService.getAccessToken();\n            if (accessToken) {\n                config.params = { ...config.params, auth: accessToken };\n            }\n        }\n        return config;\n    },\n    function (error) {\n        return Promise.reject(error);\n    }\n);\nfunction transformData(data) {\n    return data && !data._id\n        ? Object.keys(data).map((key) => ({\n            ...data[key]\n        }))\n        : data;\n}\nhttp.interceptors.response.use(\n    (res) => {\n        if (configFile.isFireBase) {\n            res.data = { content: transformData(res.data) };\n        }\n        return res;\n    },\n    function (error) {\n        const expectedErrors =\n            error.response &&\n            error.response.status >= 400 &&\n            error.response.status < 500;\n\n        if (!expectedErrors) {\n            console.log(error);\n            toast.error(\"Something was wrong. Try it later\");\n        }\n        return Promise.reject(error);\n    }\n);\nconst httpService = {\n    get: http.get,\n    post: http.post,\n    put: http.put,\n    delete: http.delete,\n    patch: http.patch\n};\nexport default httpService;\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,KAAK,QAAQ,gBAAgB;AACtC,OAAOC,UAAU,MAAM,gBAAgB;AACvC,OAAOC,mBAAmB,MAAM,wBAAwB;AACxD,OAAOC,WAAW,MAAM,gBAAgB;AAExC,MAAMC,IAAI,GAAGL,KAAK,CAACM,MAAM,CAAC;EACtBC,OAAO,EAAEL,UAAU,CAACM;AACxB,CAAC,CAAC;AAEFH,IAAI,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CACzB,gBAAgBC,MAAM,EAAE;EACpB,MAAMC,WAAW,GAAGV,mBAAmB,CAACW,mBAAmB,EAAE;EAC7D,MAAMC,YAAY,GAAGZ,mBAAmB,CAACa,eAAe,EAAE;EAE1D,IAAId,UAAU,CAACe,UAAU,EAAE;IACvB,MAAMC,YAAY,GAAG,OAAO,CAACC,IAAI,CAACP,MAAM,CAACQ,GAAG,CAAC;IAC7CR,MAAM,CAACQ,GAAG,GACN,CAACF,YAAY,GAAGN,MAAM,CAACQ,GAAG,CAACC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAGT,MAAM,CAACQ,GAAG,IAAI,OAAO;IACnE,IAAIL,YAAY,IAAIF,WAAW,GAAGS,IAAI,CAACC,GAAG,EAAE,EAAE;MAC1C,MAAMC,IAAI,GAAG,MAAMpB,WAAW,CAACqB,OAAO,EAAE;MAExCtB,mBAAmB,CAACuB,SAAS,CAAC;QAC1BX,YAAY,EAAES,IAAI,CAACG,aAAa;QAChCC,OAAO,EAAEJ,IAAI,CAACK,QAAQ;QACtBC,SAAS,EAAEN,IAAI,CAACO,UAAU;QAC1BC,OAAO,EAAER,IAAI,CAACS;MAClB,CAAC,CAAC;IACN;IACA,MAAMC,WAAW,GAAG/B,mBAAmB,CAACgC,cAAc,EAAE;IACxD,IAAID,WAAW,EAAE;MACbtB,MAAM,CAACwB,MAAM,GAAG;QAAE,GAAGxB,MAAM,CAACwB,MAAM;QAAEC,IAAI,EAAEH;MAAY,CAAC;IAC3D;EACJ,CAAC,MAAM;IACH,IAAInB,YAAY,IAAIF,WAAW,GAAGS,IAAI,CAACC,GAAG,EAAE,EAAE;MAC1C,MAAMC,IAAI,GAAG,MAAMpB,WAAW,CAACqB,OAAO,EAAE;MAExCtB,mBAAmB,CAACuB,SAAS,CAAC;QAC1BX,YAAY,EAAES,IAAI,CAACG,aAAa;QAChCC,OAAO,EAAEJ,IAAI,CAACK,QAAQ;QACtBC,SAAS,EAAEN,IAAI,CAACO,UAAU;QAC1BC,OAAO,EAAER,IAAI,CAACS;MAClB,CAAC,CAAC;IACN;IACA,MAAMC,WAAW,GAAG/B,mBAAmB,CAACgC,cAAc,EAAE;IACxD,IAAID,WAAW,EAAE;MACbtB,MAAM,CAACwB,MAAM,GAAG;QAAE,GAAGxB,MAAM,CAACwB,MAAM;QAAEC,IAAI,EAAEH;MAAY,CAAC;IAC3D;EACJ;EACA,OAAOtB,MAAM;AACjB,CAAC,EACD,UAAU0B,KAAK,EAAE;EACb,OAAOC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAChC,CAAC,CACJ;AACD,SAASG,aAAa,CAACjB,IAAI,EAAE;EACzB,OAAOA,IAAI,IAAI,CAACA,IAAI,CAACkB,GAAG,GAClBC,MAAM,CAACC,IAAI,CAACpB,IAAI,CAAC,CAACqB,GAAG,CAAEC,GAAG,KAAM;IAC9B,GAAGtB,IAAI,CAACsB,GAAG;EACf,CAAC,CAAC,CAAC,GACDtB,IAAI;AACd;AACAnB,IAAI,CAACI,YAAY,CAACsC,QAAQ,CAACpC,GAAG,CACzBqC,GAAG,IAAK;EACL,IAAI9C,UAAU,CAACe,UAAU,EAAE;IACvB+B,GAAG,CAACxB,IAAI,GAAG;MAAEyB,OAAO,EAAER,aAAa,CAACO,GAAG,CAACxB,IAAI;IAAE,CAAC;EACnD;EACA,OAAOwB,GAAG;AACd,CAAC,EACD,UAAUV,KAAK,EAAE;EACb,MAAMY,cAAc,GAChBZ,KAAK,CAACS,QAAQ,IACdT,KAAK,CAACS,QAAQ,CAACI,MAAM,IAAI,GAAG,IAC5Bb,KAAK,CAACS,QAAQ,CAACI,MAAM,GAAG,GAAG;EAE/B,IAAI,CAACD,cAAc,EAAE;IACjBE,OAAO,CAACC,GAAG,CAACf,KAAK,CAAC;IAClBrC,KAAK,CAACqC,KAAK,CAAC,mCAAmC,CAAC;EACpD;EACA,OAAOC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAChC,CAAC,CACJ;AACD,MAAMgB,WAAW,GAAG;EAChBC,GAAG,EAAElD,IAAI,CAACkD,GAAG;EACbC,IAAI,EAAEnD,IAAI,CAACmD,IAAI;EACfC,GAAG,EAAEpD,IAAI,CAACoD,GAAG;EACbC,MAAM,EAAErD,IAAI,CAACqD,MAAM;EACnBC,KAAK,EAAEtD,IAAI,CAACsD;AAChB,CAAC;AACD,eAAeL,WAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}