{"ast":null,"code":"import axios from \"axios\";\nimport { toast } from \"react-toastify\";\nimport configFile from \"../config.json\";\nimport localStorageService from \"./localStorage.service\";\nimport authService from \"./auth.service\";\nconst http = axios.create({\n  baseURL: configFile.apiEndpoint\n});\nhttp.interceptors.request.use(async function (config) {\n  const expiresDate = localStorageService.getTokenExpiresDate();\n  const refreshToken = localStorageService.getRefreshToken();\n  const isExpired = refreshToken && expiresDate < Date.now();\n  if (configFile.isFireBase) {\n    const containSlash = /\\/$/gi.test(config.url);\n    config.url = (containSlash ? config.url.slice(0, -1) : config.url) + \".json\";\n    if (isExpired) {\n      const data = await authService.refresh();\n      localStorageService.setTokens({\n        refreshToken: data.refresh_token,\n        idToken: data.id_token,\n        expiresIn: data.expires_id,\n        localId: data.user_id\n      });\n    }\n    const accessToken = localStorageService.getAccessToken();\n    if (accessToken) {\n      config.params = {\n        ...config.params,\n        auth: accessToken\n      };\n    }\n  } else {\n    if (isExpired) {\n      const data = await authService.refresh();\n      localStorageService.setTokens({\n        data\n      });\n    }\n    const accessToken = localStorageService.getAccessToken();\n    if (accessToken) {\n      config.params = {\n        ...config.params,\n        auth: accessToken\n      };\n    }\n  }\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n});\nfunction transformData(data) {\n  return data && !data._id ? Object.keys(data).map(key => ({\n    ...data[key]\n  })) : data;\n}\nhttp.interceptors.response.use(res => {\n  if (configFile.isFireBase) {\n    res.data = {\n      content: transformData(res.data)\n    };\n  }\n  return res;\n}, function (error) {\n  const expectedErrors = error.response && error.response.status >= 400 && error.response.status < 500;\n  if (!expectedErrors) {\n    console.log(error);\n    toast.error(\"Something was wrong. Try it later\");\n  }\n  return Promise.reject(error);\n});\nconst httpService = {\n  get: http.get,\n  post: http.post,\n  put: http.put,\n  delete: http.delete,\n  patch: http.patch\n};\nexport default httpService;","map":{"version":3,"names":["axios","toast","configFile","localStorageService","authService","http","create","baseURL","apiEndpoint","interceptors","request","use","config","expiresDate","getTokenExpiresDate","refreshToken","getRefreshToken","isExpired","Date","now","isFireBase","containSlash","test","url","slice","data","refresh","setTokens","refresh_token","idToken","id_token","expiresIn","expires_id","localId","user_id","accessToken","getAccessToken","params","auth","error","Promise","reject","transformData","_id","Object","keys","map","key","response","res","content","expectedErrors","status","console","log","httpService","get","post","put","delete","patch"],"sources":["/Users/dariabrusnitsina/Yandex.Disk.localized/Programming/Projects/react-e-commerce/client/src/services/http.service.js"],"sourcesContent":["import axios from \"axios\";\nimport { toast } from \"react-toastify\";\nimport configFile from \"../config.json\";\nimport localStorageService from \"./localStorage.service\";\nimport authService from \"./auth.service\";\n\nconst http = axios.create({\n    baseURL: configFile.apiEndpoint\n});\n\nhttp.interceptors.request.use(\n    async function (config) {\n        const expiresDate = localStorageService.getTokenExpiresDate();\n        const refreshToken = localStorageService.getRefreshToken();\n        const isExpired = refreshToken && expiresDate < Date.now()\n\n        if (configFile.isFireBase) {\n            const containSlash = /\\/$/gi.test(config.url);\n            config.url =\n                (containSlash ? config.url.slice(0, -1) : config.url) + \".json\";\n            if (isExpired) {\n                const data = await authService.refresh();\n\n                localStorageService.setTokens({\n                    refreshToken: data.refresh_token,\n                    idToken: data.id_token,\n                    expiresIn: data.expires_id,\n                    localId: data.user_id\n                });\n            }\n            const accessToken = localStorageService.getAccessToken();\n            if (accessToken) {\n                config.params = { ...config.params, auth: accessToken };\n            }\n        } else {\n            if (isExpired) {\n                const data = await authService.refresh();\n\n                localStorageService.setTokens({data});\n            }\n            const accessToken = localStorageService.getAccessToken();\n            if (accessToken) {\n                config.params = { ...config.params, auth: accessToken };\n            }\n        }\n        return config;\n    },\n    function (error) {\n        return Promise.reject(error);\n    }\n);\nfunction transformData(data) {\n    return data && !data._id\n        ? Object.keys(data).map((key) => ({\n            ...data[key]\n        }))\n        : data;\n}\nhttp.interceptors.response.use(\n    (res) => {\n        if (configFile.isFireBase) {\n            res.data = { content: transformData(res.data) };\n        }\n        return res;\n    },\n    function (error) {\n        const expectedErrors =\n            error.response &&\n            error.response.status >= 400 &&\n            error.response.status < 500;\n\n        if (!expectedErrors) {\n            console.log(error);\n            toast.error(\"Something was wrong. Try it later\");\n        }\n        return Promise.reject(error);\n    }\n);\nconst httpService = {\n    get: http.get,\n    post: http.post,\n    put: http.put,\n    delete: http.delete,\n    patch: http.patch\n};\nexport default httpService;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}