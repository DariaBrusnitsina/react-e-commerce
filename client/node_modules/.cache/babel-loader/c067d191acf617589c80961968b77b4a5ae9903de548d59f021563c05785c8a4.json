{"ast":null,"code":"import axios from \"axios\";\nimport { toast } from \"react-toastify\";\nimport config from \"../config.json\";\nimport localStorageService from \"./localStorage.service\";\nimport authService from \"./auth.service\";\nconst http = axios.create({\n  baseURL: config.apiEndpoint\n});\nhttp.interceptors.request.use(async function (config) {\n  const expiresDate = localStorageService.getTokenExpiresDate();\n  const refreshToken = localStorageService.getRefreshToken();\n  const isExpired = refreshToken && expiresDate < Date.now();\n  if (config.isFireBase) {\n    const containSlash = /\\/$/gi.test(config.url);\n    config.url = (containSlash ? config.url.slice(0, -1) : config.url) + \".json\";\n    if (isExpired) {\n      const data = await authService.refresh();\n      localStorageService.setTokens({\n        refreshToken: data.refresh_token,\n        idToken: data.id_token,\n        expiresIn: data.expires_id,\n        localId: data.user_id\n      });\n    }\n    const accessToken = localStorageService.getAccessToken();\n    if (accessToken) {\n      config.params = {\n        ...config.params,\n        auth: accessToken\n      };\n    }\n  } else {\n    if (isExpired) {\n      const data = await authService.refresh();\n      localStorageService.setTokens({\n        data\n      });\n    }\n    const accessToken = localStorageService.getAccessToken();\n    if (accessToken) {\n      config.headers = {\n        ...config.headers,\n        Authorization: `Bearer ${accessToken}`\n      };\n    }\n  }\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n});\nfunction transformData(data) {\n  return data && !data._id ? Object.keys(data).map(key => ({\n    ...data[key]\n  })) : data;\n}\nhttp.interceptors.response.use(res => {\n  if (config.isFireBase) {\n    res.data = {\n      content: transformData(res.data)\n    };\n  }\n  return res.data = {\n    content: res.data\n  };\n  return res;\n}, function (error) {\n  const expectedErrors = error.response && error.response.status >= 400 && error.response.status < 500;\n  if (!expectedErrors) {\n    toast.error(\"Something was wrong. Try it later\");\n  }\n  return Promise.reject(error);\n});\nconst httpService = {\n  get: http.get,\n  post: http.post,\n  put: http.put,\n  delete: http.delete,\n  patch: http.patch\n};\nexport default httpService;","map":{"version":3,"names":["axios","toast","config","localStorageService","authService","http","create","baseURL","apiEndpoint","interceptors","request","use","expiresDate","getTokenExpiresDate","refreshToken","getRefreshToken","isExpired","Date","now","isFireBase","containSlash","test","url","slice","data","refresh","setTokens","refresh_token","idToken","id_token","expiresIn","expires_id","localId","user_id","accessToken","getAccessToken","params","auth","headers","Authorization","error","Promise","reject","transformData","_id","Object","keys","map","key","response","res","content","expectedErrors","status","httpService","get","post","put","delete","patch"],"sources":["/Users/dariabrusnitsina/Yandex.Disk.localized/Programming/Projects/react-e-commerce/client/src/services/http.service.js"],"sourcesContent":["import axios from \"axios\";\nimport { toast } from \"react-toastify\";\nimport config from \"../config.json\";\nimport localStorageService from \"./localStorage.service\";\nimport authService from \"./auth.service\";\n\nconst http = axios.create({\n    baseURL: config.apiEndpoint\n});\n\nhttp.interceptors.request.use(\n    async function (config) {\n        const expiresDate = localStorageService.getTokenExpiresDate();\n        const refreshToken = localStorageService.getRefreshToken();\n        const isExpired = refreshToken && expiresDate < Date.now()\n\n        if (config.isFireBase) {\n            const containSlash = /\\/$/gi.test(config.url);\n            config.url =\n                (containSlash ? config.url.slice(0, -1) : config.url) + \".json\";\n            if (isExpired) {\n                const data = await authService.refresh();\n\n                localStorageService.setTokens({\n                    refreshToken: data.refresh_token,\n                    idToken: data.id_token,\n                    expiresIn: data.expires_id,\n                    localId: data.user_id\n                });\n            }\n            const accessToken = localStorageService.getAccessToken();\n            if (accessToken) {\n                config.params = { ...config.params, auth: accessToken };\n            }\n        } else {\n            if (isExpired) {\n                const data = await authService.refresh();\n                localStorageService.setTokens({data});\n            }\n            const accessToken = localStorageService.getAccessToken();\n            if (accessToken) {\n                config.headers = { ...config.headers, Authorization: `Bearer ${accessToken}`};\n            }\n        }\n        return config;\n    },\n    function (error) {\n        return Promise.reject(error);\n    }\n);\nfunction transformData(data) {\n    return data && !data._id\n        ? Object.keys(data).map((key) => ({\n            ...data[key]\n        }))\n        : data;\n}\nhttp.interceptors.response.use(\n    (res) => {\n        if (config.isFireBase) {\n            res.data = { content: transformData(res.data) };\n        }\n        return res.data = { content: res.data };\n        return res;\n    },\n    function (error) {\n        const expectedErrors =\n            error.response &&\n            error.response.status >= 400 &&\n            error.response.status < 500;\n\n        if (!expectedErrors) {\n            toast.error(\"Something was wrong. Try it later\");\n        }\n        return Promise.reject(error);\n    }\n);\nconst httpService = {\n    get: http.get,\n    post: http.post,\n    put: http.put,\n    delete: http.delete,\n    patch: http.patch\n};\nexport default httpService;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}